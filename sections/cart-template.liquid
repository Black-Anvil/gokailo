<head>
  <!-- Event snippet for Purchase - Website conversion page In your html page, add the snippet and call gtag_report_conversion when someone clicks on the chosen link or button. --> <script> function gtag_report_conversion(url) { var callback = function () { if (typeof(url) != 'undefined') { window.location = url; } }; gtag('event', 'conversion', { 'send_to': 'AW-726205991/PUAwCIm8uqUBEKeMpNoC', 'value': 95.0, 'currency': 'USD', 'transaction_id': '', 'event_callback': callback }); return false; } </script>

  <!-- Facebook Pixel Code -->
  <script>
    if(typeof fbq === 'undefined') {
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
       if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
       n.queue=[];t=b.createElement(e);t.async=!0;
       t.src=v;s=b.getElementsByTagName(e)[0];
       s.parentNode.insertBefore(t,s)}(window, document,'script',
                                       'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1152496025269439');
      fbq('trackCustom', 'CartView');
    }
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
         src="https://www.facebook.com/tr?id=1152496025269439&ev=PageView&noscript=1"
         />
  </noscript>

</head>
<style>
  div#shopify-section-header {
      display: none;
  }
  .popup-inner {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
  }
  .popup-inner__left {
    min-width: 252px;
  }
  .hidden {
    display:none;
  }
  .popup-button{
      background: linear-gradient(to bottom,#f3ce75 0,#edb52f 100%) !important;
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 20%), 0 0 0 1px;
      border: solid 1px #c2ac72;
      border-radius: 10px;
      color: #fff;
      font-size: 1.2em;
      font-weight: 600;
      margin: 20px auto;
      width:fit-content;
      border: solid 1px #c2ac72;
      display:block;
  }
  .popup-button:hover{
      cursor: pointer;
  }
  .white-popup {
      position: relative;
      background: #FFF;
      padding: 40px;
      width: auto;
      max-width: 1200px;
      margin: 20px auto;
      font-size: x-large;
      line-height: normal;
      border: solid 10px #000;
  }
  .special {
    display: block;
    text-align: center;
  }
  .rate {
    text-align: center;
    display: flex;
    justify-content: center;
    line-height: 1;
  }
  .number {
    font-size: 6em;
    font-weight: 600;
  }
  .percent-off {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  .percent {
    top: -0.5em;
    font-size: 3.5em;
    font-weight: 600;
  }
  .off {
    left: -2.3em;
    font-size: 1.5em;
    font-weight: 600;
  }
  .special-image {
    /* width: 85%; */
    margin: auto;
    display: block;
  }
  .popup-inner__right {
    line-height: 1;
  }
  .popup-inner__right p {
    margin: 0 auto 20px auto;
  }
  .act-now {
    display: block;
    font-size: 1.2em;
    font-weight: 600;
    text-align: center;
  }
  .offer {
    display: block;
    width: 85%;
    margin: 0 auto;
    font-size: 1.9em;
    font-weight: 600;
    text-align: center;
    color: #ff6b01;
  }
  .original-price {
    display: block;
    text-align: center;
    text-decoration: line-through;
    color: red;
  }
  .new-price {
    display: block;
    text-align: center;
  }
  .yes-bundle {
    margin: 0 0 1em 0;
    text-align: center;
  }
  .popup-button p {
    border-radius: 10px;
    color: #000;
    padding: 0.8em 1.2em;
    font-weight: 700;
    font-size: 1.1em;
    margin: 0;
  }
  .no-thanks {
    display: block;
    text-align: center;
  }
  .no-thanks a {
    color: #5cbd64;
    text-decoration: underline;
    cursor: pointer;
  }
  .mfp-close {
    display: none !important;
  }
  .cart-warning {
    line-height: 1.2;
    border: 1px solid red;
    color: red;
    padding: 10px;
    font-weight: bold;
  }
  .cart-warning__btn {
    width: 100%;
    min-height: 60px;
    padding: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    cursor: pointer;
  }
  @media screen and (max-width: 1105px) {
    .number {
      font-size: 4.5em;
    }
    .percent {
      font-size: 2.5em;
    }
    .off {
      font-size: 1em;
    }
  }
  @media screen and (max-width: 768px) {
    .popup-inner {
      flex-direction: column;
      gap: 40px;
    }
    .popup-inner__left {
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }
  @media screen and (max-width: 425px) {
    .popup-inner {
      gap: 20px;
    }
    .white-popup {
      padding: 20px;
    }
    .offer {
      font-size: 1.5em;
    }
  }
</style>

{% liquid
  if section.settings.basic_header
    render'header-basic-link'
  endif
  assign bundle_item_1 = false
  assign bundle_item_2 = false
  assign kailo_adhesives = false
  assign flex_adhesives = false
  assign kailo_in_cart = false
  assign flex_in_cart = false
  for item in cart.items
    if item.id == 32217170608259
      assign bundle_item_1 = true
    elsif item.id == 20859019427902
      assign bundle_item_2 = true
    endif
    if item.product.tags contains 'kailo adhesives'
      assign kailo_adhesives = true
    elsif item.product.tags contains 'flex adhesives'
      assign flex_adhesives = true
    endif
    if item.product.metafields.custom.original_product == true
      assign kailo_in_cart = true
    endif
    if item.product.metafields.custom.flex_product == true
      assign flex_in_cart = true
    endif
  endfor
%}
<div id="CartSection" class="page-width" data-section-id="{{ section.id }}" data-section-type="cart-template">
  {% capture header_title %} {{ 'cart.general.title' | t }} {% endcapture %}
  {% include 'page_header' with header_title %}
 
  <div class="wrapper wrapper--margins wrapper--mini">

    {% if cart.item_count > 0 %}
   
      <form id="cart-form" action="/cart" method="post" novalidate class="cart table-wrap">

        {% for item in cart.items %}

          {% comment %} {% if item.id == 32217170608259 %}
          {% assign bundle_item_1 = true %}
          {% endif %}
          {% if item.id == 20859019427902 %}
            {% assign bundle_item_2 = true %}
          {% endif %}
          {% if item.product.tags contains 'kailo adhesives' %}
            {% assign kailo_adhesives = true %}
          {% endif %}
          {% if item.product.tags contains 'flex adhesives' %}
            {% assign flex_adhesives = true %}
          {% endif %} {% endcomment %}

          <div class="cart-row cart-item clearfix" data-id="{{ item.key }}">

            {% if item.image %}
            <a class="cart-img" href="{{ item.url }}">
              <img class="cart__image" src="{{ item | img_url: '150x150', scale: 2 }}" alt="{{ item.title | escape }}">
              {% if item.product.tags contains 'flex adhesives' %}
                <div class="adhesive-tag in-cart">
                  <span class="text-center">for flex patch only<span>
                </div>
              {% elsif item.product.tags contains 'kailo adhesives' %}
                <div class="adhesive-tag kailo-adhesive in-cart">
                  <span class="text-center">for kailo original only<span>
                </div>
              {% endif %}
            </a>
            {% endif %}

            <div class="cart-item__content">

              <div class="cart-item__wrapper">

                <div class="cart-item__description">

                  <h2 class="h3 cart-item__title"><a href="{{ item.url }}">{{ item.product.title }}</a></h2>

                  {% unless item.variant.title contains 'Default' %}
                  <small class="cart-item__variant-title">{{ item.variant.title }}</small>
                  {% endunless %}

                  <span class="bold_ro_desc" data-product-id="{{item.id}}-{{ forloop.index0 }}"></span>
                  <span class="bold_load_cart_item_properties"></span>
                  
                  {% assign property_size = item.properties | size %}
                  {% if property_size > 0 %}

                  {%- comment -%}
                  {% for p in item.properties %}
                  {% assign first_character_in_key = p.first | truncate: 1, '' %}
                  {% unless p.last == blank or p.first == "subscription_id" or p.first == "shipping_interval_frequency" or p.first == "shipping_interval_unit_type" or first_character_in_key == '_' %}
                  <div class="cart-item__property">
                    {{ p.first }}:
                    {% if p.last contains '/uploads/' %}
                    <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
                    {% else %}
                    {{ p.last }}
                    {% endif %}
                  </div>
                  {% endunless %}
                  {% endfor %}
                  {%- endcomment -%}
                  
                  {% endif %}
                

                  <div>
                    {%- if item.original_price != item.final_price -%}
                    <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>

                    <del class="cart-item__line-price cart-item__line-price--original"><div class="pn-price-item" data-id="{{ item.key }}">{{ item.original_price | money }}</div></del>
                    <span class="visually-hidden">{{ 'products.product.sale_price' | t }}</span>

                    <span class="cart-item__line-price price">{{ item.final_price | money }}</span>
                    {%- else -%}
                    <span class="Bold-theme-hook-DO-NOT-DELETE bold_cart_item_price" data-item-key="{{item.key}}" style="display:none !important;"></span>
                    <span class="cart-item__line-price price"><div class="pn-price-item" data-id="{{ item.key }}">{{ item.original_price | money }}</div></span>
                    {%- endif -%}
                  </div>
                  {% if item.product.tags contains 'kailo adhesives' and kailo_in_cart == false and flex_in_cart == true %}
                    <p class="cart-warning">Note: These Kailo Original adhesives are not compatible with a Flex product in your cart.</p>                   
                    <a id="flex-adhesives" class="btn btn--fill btn--color cart-warning__btn">Replace with Flex adhesives</a>
                  {% elsif item.product.tags contains 'flex adhesives' and flex_in_cart == false and kailo_in_cart == true %}
                    <p class="cart-warning">Note: These Flex adhesives are not compatible with a Kailo Original product in your cart.</p>
                    <a id="kailo-adhesives" class="btn btn--fill btn--color cart-warning__btn">Replace with Kailo Original adhesives</a>
                  {% endif %}
                </div>

                {%- if item.line_level_discount_allocations != blank -%}
                <div class="cart-item__discounts">
                  <ul class="order-discount order-discount--list order-discount--title" aria-label="{{ 'customer.order.discount' | t }}">
                    {%- for discount_allocation in item.line_level_discount_allocations -%}
                    <li class="order-discount__item">
                      <span aria-hidden="true">{%- include 'asset_svg' with 'saletag' -%}</span>{{ discount_allocation.discount_application.title }} (-{{ discount_allocation.amount | money }})
                    </li>
                    {%- endfor -%}
                  </ul>
                </div>
                {%- endif -%}

              </div>

            </div>

            <label for="updates_{{ item.key }}" class="fallback-text">{{ 'cart.general.quantity' | t }}</label>
            <input class="count qty-remove-defaults" type="number" name="updates[]" id="updates_{{ item.key }}" value="{{ item.quantity }}" min="0" data-id="{{ item.key }}">
            <a {% if item.product.tags contains 'kailo adhesives' %}id="kailo" {% elsif item.product.tags contains 'flex adhesives' %}id="flex" {% endif %}class="remove" href="/cart/change?line={{ forloop.index }}&amp;quantity=0" data-id="{{ item.key }}">
              <span aria-hidden="true">{% include 'asset_svg' with 'close' %}</span>
              <span class="fallback-text">{{ 'cart.general.remove_item' | t }}</span>
            </a>

          </div>

        {% endfor %}

        <div class="cart_bottom grid">

          {% if section.settings.cart_notes_enable %}
          <div class="grid__item large--one-half">
            <label for="CartSpecialInstructions">{{ 'cart.general.note' | t }}</label>
            <textarea name="note" class="input-full" id="CartSpecialInstructions">{{ cart.note }}</textarea>
          </div>
          {% endif %}

          <div class="grid__item{% if section.settings.cart_notes_enable %} large--one-half{% endif %} text-right">
            <div class="cart__subtotal-holder">
              {%- if cart.cart_level_discount_applications != blank -%}
              <div class="order-discount-cart-wrapper">
                {%- for discount_application in cart.cart_level_discount_applications -%}
                <span class="order-discount order-discount--title">
                  <span aria-hidden="true">{%- include 'asset_svg' with 'saletag' -%}</span><span class="visually-hidden">{{ 'customer.order.discount' | t }}:</span>{{- discount_application.title -}}
                </span>
                <span class="order-discount"><strong>-{{ discount_application.total_allocated_amount | money }}</strong></span>
                {%- endfor -%}
              </div>
              {%- endif -%}
              <span class="cart__subtotal-title">{{ 'cart.general.subtotal' | t }}</span>
              <span class="Bold-theme-hook-DO-NOT-DELETE bold_cart_total" style="display:none !important;"></span>
              <span class="h3 cart__subtotal">{{ cart.total_price | money }}</span>

              {%- capture taxes_shipping_checkout -%}
              {%- if shop.taxes_included and shop.shipping_policy.body != blank -%}
              {{ 'cart.general.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
              {%- elsif shop.taxes_included -%}
              {{ 'cart.general.taxes_included_but_shipping_at_checkout' | t }}
              {%- elsif shop.shipping_policy.body != blank -%}
              {{ 'cart.general.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
              {%- else -%}
              {{ 'cart.general.taxes_and_shipping_at_checkout' | t }}
              {%- endif -%}
              {%- endcapture -%}

              <span class="cart__subtotal-shipping">{{ taxes_shipping_checkout }}</span>
            </div>
            <button type="submit" name="update" class="btn btn--regular btn--dark btn--outline btn__update">
              <span aria-hidden="true">{% include 'asset_svg' with 'reload' %}</span>
              <span class="fallback-text">{{ 'cart.general.update_cart' | t }}</span>
            </button>
            {% assign test_bundle = false %}
            {% for item in cart.items %}
              {% if item.product.tags contains '45_bundle' %}
                {% assign test_bundle = true %}
                {% assign current_variant = item %}
              {% endif %}
            {% endfor %}
            {% if test_bundle == true %}
              <a href="#bundle-discount" class="inline-popup btn btn--regular btn--color btn--fill">Check Out</a>
              <div id="bundle-discount" class="white-popup mfp-hide">
                  <div class="popup-inner toggle-me">
                    <div class="popup-inner__left">
                      <div class="popup-inner__left-text">
                        <div class="special">Special Offer!</div>
                        <div class="rate">
                            <div class="number">45</div>
                            <div class="percent-off">
                              <div class="percent">%</div>
                              <div class="off">OFF</div>
                            </div>
                        </div>
                      </div>
                      <div class="popup-inner__left-img">
                        <img class="special-image lazyload" data-src="https://cdn.shopify.com/s/files/1/0121/1537/8238/files/kailo-b1-01_0bd95b4e-2f90-4e71-82c1-0e17776dd16a_500x.jpg?v=1651516940" width="250" />
                      </div>
                    </div>
                    <div class="popup-inner__right">
                      <p class="act-now">Act Now and Get...</p>
                      <p class="offer">a Kailo bundle for 45% OFF!</p>
                      <p class="original-price">$119 Value</p>
                      <p class="new-price">Special Add-on Price = $65.45!</p>
                      <div class="yes-bundle">
                          <a class="popup-button toggle-me" data-bundle="32251489255555" style="font-size:1em;">
                              <p>Yes, Get My 45% Savings</p>
                          </a>
                      </div>
                      <div class="no-thanks"><a data-bundle="false">No Thank You</a></div>
                    </div>
                  </div>
                  <div class="popup-inner toggle-me hidden">
                    <div class="popup-inner__left">
                      <span class="special">Adhesive 10 Pack | Kailo Patch Adhesives</span>
                      <center><img class="special-image lazyload" data-src="https://cdn.shopify.com/s/files/1/0121/1537/8238/products/kailo-pain-relief-adheasive-10pack_500x.jpg?v=1601653525" width="450" /></center>
                    </div>
                    <div class="popup-inner__right">
                      <p class="act-now">Need Adhesives?</p>
                      <p class="offer">Add a 10 Pack Kailo Patch Adhesives to my order</p>
                      <p class="new-price">Price = $24.99</p>
                      <div class="yes-bundle">
                          <a class="popup-button toggle-me" data-bundle="20859019427902" style="font-size:1em;">
                              <p>Yes, Add Kailo Patch Adhesives</p>
                          </a>
                      </div>
                      <div class="no-thanks"><a data-bundle="false">No Thank You</a></div>
                    </div>
                  </div>
              </div>
              <button type="submit" name="checkout" class="btn btn--regular btn--color btn--fill hidden">{{ 'cart.general.checkout' | t }}</button>

            {% else %}
              <button type="submit" name="checkout" class="btn btn--regular btn--color btn--fill">{{ 'cart.general.checkout' | t }}</button>
            {% endif %}
          </div>
          <div class="grid__item{% if section.settings.cart_notes_enable %} large--one-half{% endif %} text-right">
            {% if cart.item_count > 0 %}
            <div id="bread-checkout-btn" style="float:right; height:50px; margin:20px 0px; width:230px;"></div>
            {% endif %}
          </div>

        </div>

      </form>
      {% comment %} Show adhesive and kt tape addon uncomment 192 - 196
      {% unless bundle_item_1 == true and bundle_item_2 == true %}
      {% include 'cart-bundle' %}
      {% endunless %}
      {% endcomment %}

      {% comment %}	
      {% if bundle_discount == 'true' %}
      <a href="#bundle-discount" class="inline-popup product-link bundle_discont addtocart btn btn--fill btn--regular btn--color btn--shopify-payment-btn btn--secondary-accent cartbutton" style="text-align:center; display:none;">Check Out</a>
      {% endif %}
      {% endcomment %}	
    {% else %}

      <div class="text-center">
        <p class="cart--empty-message">{{ 'cart.general.empty' | t }}</p>
        <div class="cart--cookie-message">
          <p>{{ 'cart.general.cookies_required' | t }}</p>
        </div>
        <a href="/collections/all-pain-patches" class="btn btn--dark btn--outline btn--small cart__continue-btn">
          {{ 'cart.general.continue_browsing' | t }}
        </a>
      </div>

    {% endif %}

  </div>

</div>

<script>

  const flexRemover = document.querySelector('#flex');
  const kailoRemover = document.querySelector('#kailo');
  const removeAdhesives = sessionStorage.getItem('removeAdhesives');
  if (removeAdhesives === 'flex') {
    sessionStorage.removeItem('removeAdhesives');
    flexRemover.click();
  }
  if (removeAdhesives === 'kailo') {
    sessionStorage.removeItem('removeAdhesives');
    kailoRemover.click();
  }

  const flexAdhesivesBtn = document.querySelector('#flex-adhesives');
  if (flexAdhesivesBtn) {
    flexAdhesivesBtn.addEventListener('click', function(e) {
      e.preventDefault();
      sessionStorage.setItem('removeAdhesives', 'kailo');
      window.location.pathname = '/cart/add/42789177491587';
    });
  }

  const kailoAdhesivesBtn = document.querySelector('#kailo-adhesives');
  if (kailoAdhesivesBtn) {
    kailoAdhesivesBtn.addEventListener('click', function(e) {
      e.preventDefault();
      sessionStorage.setItem('removeAdhesives', 'flex');
      window.location.pathname = '/cart/add/20859019427902';
    });
  }

</script>

{% schema %}
{
  "name": {
  "de": "Warenkorb-Seite",
  "en": "Cart page",
  "es": "Página de carrito",
  "fr": "Page du panier",
  "it": "Pagina del carrello",
  "ja": "カートページ",
  "nl": "Winkelwagenpagina",
  "pt-BR": "Página do carrinho",
  "zh-CN": "购物车页面",
  "zh-TW": "購物車頁面"
  },
  "settings": [
    {
    "type": "checkbox",
    "id": "cart_notes_enable",
    "label": {
    "de": "Warenkorb-Notifikationen erlauben",
    "en": "Enable cart notes",
    "es": "Habilitar notas de carrito",
    "fr": "Activer les notes de panier",
    "it": "Abilita note carrello",
    "ja": "カートメモを有効にする",
    "nl": "Notities voor winkelwagen inschakelen",
    "pt-BR": "Ativar observações sobre o carrinho",
    "zh-CN": "启用购物车备注",
    "zh-TW": "啟用購物車備註"
    },
    "default": false
    },
    {
      "type": "checkbox",
      "id": "basic_header",
      "label": "Use basic header link",
      "default": true
    }
  ]
}
{% endschema %}

{% javascript %}
 
{% endjavascript %}

<script type="text/javascript">
//Things
    const popupActions = document.querySelectorAll('[data-bundle]');
    const checkoutButton = document.querySelector('button[name="checkout"]');
    const xSellButton = document.querySelector('.inline-popup');
    let allowCrossSell = sessionStorage.getItem("allowCrossSell");
    if (allowCrossSell === "false") {
      document.addEventListener("DOMContentLoaded", function() {
        checkoutButton.classList.remove('hidden');
        xSellButton.classList.add('hidden');
        sessionStorage.clear();
      })
    }
//Data
    let timesClicked = 0;
    data = {};
    data.items = [
            {% comment %} {
            id: {{ current_variant.id }},
            quantity: 1
            } {% endcomment %}
        ];
//Functions
    function buildProductObject(e){
        console.log('before', timesClicked)
       if(timesClicked < 1){
            const toggleElements = document.querySelectorAll('.toggle-me');
            toggleElements.forEach(element => {
            element.classList.toggle('hidden');
        })
       }
       if(timesClicked <= 1 && this.dataset.bundle != 'false'){
           const bundleProduct = {
                id: this.dataset.bundle,
                quantity: 1,
                properties: {
                  '_discount': this.dataset.discount ? this.dataset.discount : ''
                }
           }
           console.log("data.items: ", data.items);
           data.items.push(bundleProduct);
           console.log(data);
       }
       if(timesClicked == 1){
           addAllItems(data, e);
       }
        timesClicked ++;
        console.log('after', timesClicked)
    }
//Events
    popupActions.forEach(close => {
        close.addEventListener('click', buildProductObject);
    });
//Actions

//Tests

//onclick="bundle('{{ current_variant.id }}','true')"
    function addAllItems(data, e) {
        e.target.closest('#bundle-discount').querySelector('.mfp-close').click();
        fetch('/cart/add.js', {
            body: JSON.stringify(data),
            credentials: 'same-origin',
            headers: {
            'Content-Type': 'application/json',
            'X-Requested-With':'xmlhttprequest'
            },
            method: 'POST'
        }).then((response) => {
            return response.json();
        }).then((json) => {
            /* yay! our products were added - do something here to indicate to the user */
            sessionStorage.setItem("allowCrossSell", false);
            location.href='/cart';
        }).catch((err) => {
            /* uh oh, we have error. */
            console.error(err)
        });
    }
</script>

<script>
  $(document).ready(function() {
    $('.inline-popup').magnificPopup({
      type:'inline',
      midClick: true,
      closeOnBgClick: false,
      enableEscapeKey: false
    });
  })
</script>